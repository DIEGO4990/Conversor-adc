#include <SPI.h>
#include <nRF24L01.h>
#include <RF24.h>

#define LED_PIN 2        // LED para feedback visual
#define RELE_PIN 15      // GPIO para acionar o mÃ³dulo relÃ© (ajuste conforme sua placa)

RF24 radio(5, 17);       // CE = GPIO5, CSN = GPIO17 (ajuste se necessÃ¡rio)
const byte endereco[6] = "NODE1"; // mesmo endereÃ§o usado no transmissor

void setup() {
  Serial.begin(115200);
  
  pinMode(LED_PIN, OUTPUT);
  pinMode(RELE_PIN, OUTPUT);

  digitalWrite(LED_PIN, LOW);
  digitalWrite(RELE_PIN, LOW); // RelÃ© desligado inicialmente

  if (!radio.begin()) {
    Serial.println("âŒ Erro ao iniciar mÃ³dulo nRF24L01");
    while (true); // trava o cÃ³digo
  }

  radio.setPALevel(RF24_PA_LOW);
  radio.setChannel(108);         // Mesmo canal que o emissor
  radio.setDataRate(RF24_1MBPS); // Taxa compatÃ­vel com o transmissor
  radio.openReadingPipe(1, endereco);
  radio.startListening();

  Serial.println("ğŸŸ¢ Receptor NRF24 pronto para receber comandos");
}

void loop() {
  if (radio.available()) {
    char comando[32] = "";
    radio.read(&comando, sizeof(comando));

    Serial.print("ğŸ“© Comando recebido: ");
    Serial.println(comando);

    if (strcmp(comando, "LED_ON") == 0) {
      digitalWrite(LED_PIN, HIGH);
      digitalWrite(RELE_PIN, HIGH);  // Liga o relÃ©
      Serial.println("ğŸ’¡ LED ligado | ğŸ”Œ RELÃ‰ acionado");
    } 
    else if (strcmp(comando, "LED_OFF") == 0) {
      digitalWrite(LED_PIN, LOW);
      digitalWrite(RELE_PIN, LOW);   // Desliga o relÃ©
      Serial.println("ğŸŒ‘ LED desligado | ğŸ”Œ RELÃ‰ desligado");
    } 
    else {
      Serial.println("âš ï¸ Comando desconhecido!");
    }
  }
}
